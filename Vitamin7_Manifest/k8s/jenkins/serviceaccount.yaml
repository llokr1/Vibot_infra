apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: jenkins-admin
rules:
  - apiGroups: [""]
    resources: ["*"]
    verbs: ["*"]
  # 프로젝트 변경: apps API 그룹 권한 추가 (Deployment, StatefulSet 등 관리용)
  - apiGroups: ["apps"]
    resources: ["*"]
    verbs: ["*"]
  # 프로젝트 변경: networking.k8s.io API 그룹 권한 추가 (Ingress, IngressClass 등 관리용)
  - apiGroups: ["networking.k8s.io"]
    resources: ["*"]
    verbs: ["*"]
  # Jenkins 파이프라인에서 RBAC 객체, 배치 잡, CRD를 다룰 수 있도록 추가 권한 부여
  - apiGroups: ["rbac.authorization.k8s.io"]
    resources: ["roles", "rolebindings", "clusterroles", "clusterrolebindings"]
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete", "deletecollection"]
  - apiGroups: ["batch"]
    resources: ["jobs", "cronjobs"]
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete", "deletecollection"]
  # Jenkins가 Elasticsearch CRD를 관리할 수 있도록 elasticsearch.k8s.elastic.co API 그룹 권한 추가
  - apiGroups: ["elasticsearch.k8s.elastic.co"]
    resources: ["*"]
    verbs: ["*"]
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: jenkins-admin
  namespace: devops-tools
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: jenkins-admin
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: jenkins-admin
subjects:
  - kind: ServiceAccount
    name: jenkins-admin
    namespace: devops-tools

